for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(ncbi_family$childtaxa_name[j], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
rm(df_c2g)
nrow(ncbi_family)
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(ncbi_family$childtaxa_name[j], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
ncbi_family$childtaxa_name[j]
rm(df_c2g)
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
rm(df_c2g)
ncbi_children(name = "Nemastomataceae")
rm(df_c2g)
nrow(df_c2f)
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j])[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
rm(df_c2g)
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = ncbi_genus$parent[k])[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = ncbi_genus$parent[j])[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2f, genus)
}
genus
ncbi_children(name = "Wurdemanniaceae")
j
ncbi_family[j,]
ncbi_family$parent[84]
class(ncbi_family$childtaxa_name[84])
class(ncbi_family$childtaxa_name[83])
class(ncbi_family$childtaxa_name[82])
class(ncbi_family$childtaxa_name[85])
ncbi_family$childtaxa_name[85]
nrow(ncbi_family)
df_c2g
class(df_c2g$parent)
class(df_c2g$childtaxa_name)
df_c2f <- df
for (i in 1:nrow(df)){
family <- ncbi_children(name = df$childtaxa_name[i], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "family")
family$parent <- df$childtaxa_name[i]
family$parent_rank <- "order"
print(family)
df_c2f <- rbind(df_c2f, family)
}
df_c2f
ncbi_order <<- filter(df_c2f, childtaxa_rank == "order") %>% arrange(childtaxa_name)
ncbi_family <<- filter(df_c2f, childtaxa_rank == "family") %>% arrange(childtaxa_name)
df_c2g <- df_c2f
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
j
ncbi_children(name = "Wurdemanniaceae")
ncbi_children(name = "Wurdemanniaceae", ancestor = "Florideophyceae")
ncbi_children(name = "Wurdemanniaceae", ancestor = "Florideophyceae")[1]
ncbi_children(name = "Wurdemanniaceae", ancestor = "Florideophyceae")[1][[1]]
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
ncbi_family[84]
ncbi_family[83]
ncbi_family$childtaxa_name[84]
df_c2g
df_c2g <- df_c2f
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
df_c2g <- df_c2f
for (j in 70:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
df <- ncbi_children(name = startertaxa, ancestor = "Rhodophyta")[1][[1]] %>% filter(childtaxa_rank == "order") %>% arrange(childtaxa_name)
df$parent <- startertaxa
df$parent_rank <- "class"
print(df)
df_c2f <- df
startertaxa <- "Florideophyceae"
df <- ncbi_children(name = startertaxa, ancestor = "Rhodophyta")[1][[1]] %>% filter(childtaxa_rank == "order") %>% arrange(childtaxa_name)
df$parent <- startertaxa
df$parent_rank <- "class"
print(df)
df_c2f <- df
for (i in 1:nrow(df)){
family <- ncbi_children(name = df$childtaxa_name[i], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "family")
family$parent <- df$childtaxa_name[i]
family$parent_rank <- "order"
print(family)
df_c2f <- rbind(df_c2f, family)
}
ncbi_order <<- filter(df_c2f, childtaxa_rank == "order") %>% arrange(childtaxa_name)
ncbi_family <<- filter(df_c2f, childtaxa_rank == "family") %>% arrange(childtaxa_name)
df_c2g <- df_c2f
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
df_c2g <- df_c2f
df_c2g
df_c2g <- df_c2f
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
ncbi_genus <<- filter(df_c2g, childtaxa_rank == "genus") %>% arrange(childtaxa_name)
df_c2s <- df_c2g
df_c2s
ncbi_genus
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2g, species)
}
df_c2s <- df_c2g
df_c2s
df_c2s <- df_c2g
df_c2s
df_c2g
ncbi_genus
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
df_c2s <- df_c2g
df_c2s
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
nrow(ncbi_genus)
df_c2s <- df_c2g
which(ncbi_genus$childtaxa_name == "Champia")
for (k in 1:100){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
df_c2s <- df_c2g
for (k in 1:100){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
tax_ncbi <- read.csv("../data/ncbi_taxonomy.csv")
tax_summary_ncbi <- apply(tax_ncbi, 2, function(x)length(unique(x)))
startertaxa <- "Florideophyceae"
df <- ncbi_children(name = startertaxa, ancestor = "Rhodophyta")[1][[1]] %>% filter(childtaxa_rank == "order") %>% arrange(childtaxa_name)
df$parent <- startertaxa
df$parent_rank <- "class"
print(df)
df_c2f <- df
library(taxize)
library(dplyr)
library(lazyeval)
df <- ncbi_children(name = startertaxa, ancestor = "Rhodophyta")[1][[1]] %>% filter(childtaxa_rank == "order") %>% arrange(childtaxa_name)
df$parent <- startertaxa
df$parent_rank <- "class"
print(df)
df_c2f <- df
for (i in 1:nrow(df)){
family <- ncbi_children(name = df$childtaxa_name[i], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "family")
family$parent <- df$childtaxa_name[i]
family$parent_rank <- "order"
print(family)
df_c2f <- rbind(df_c2f, family)
}
for (i in 1:nrow(df)){
family <- ncbi_children(name = df$childtaxa_name[i], ancestor = "Rhodophyta")[1][[1]] #%>% filter(childtaxa_rank == "family")
family$parent <- df$childtaxa_name[i]
family$parent_rank <- "order"
print(family)
df_c2f <- rbind(df_c2f, family)
}
df_c2f
ncbi_order <- filter(df_c2f, childtaxa_rank == "order") %>% arrange(childtaxa_name)
ncbi_family <- filter(df_c2f, childtaxa_rank == "family") %>% arrange(childtaxa_name)
nrow(ncbi_family)
nrow(ncbi_order)
df_c2g <- df_c2f
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
genus
nrow(genus)
df_c2g <- df_c2f
missing_families <- c()
as.character(ncbi_family_childtaxa_name[j])
as.character(ncbi_family$childtaxa_name[j])
print(paste("Missing taxa", as.character(ncbi_family$childtaxa_name[j]) "due to API query error"))
print(paste("Missing taxa ", as.character(ncbi_family$childtaxa_name[j]), " due to API query error", sep= ""))
df_c2g <- df_c2f
missing_families <- c()
for (j in 1:nrow(ncbi_family)){
genus <- ncbi_children(name = ncbi_family$childtaxa_name[j], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
if (nrow(genus) > 0) {
genus$parent <- ncbi_family$childtaxa_name[j]
genus$parent_rank <- "family"
print(genus)
df_c2g <- rbind(df_c2g, genus)
}
else {
missing_families <- append(missing_families, ncbi_family$childtaxa_name[j])
print(paste("Missing family ", as.character(ncbi_family$childtaxa_name[j]), " children due to API query error", sep= ""))
}
}
missing_families
ncbi_genus
ncbi_genus <<- filter(df_c2g, childtaxa_rank == "genus") %>% arrange(childtaxa_name)
ncbi_genus
df_c2s
df_c2s <- df_c2g
df_c2s
ncbi_genus
ncbi_family
ncbi_order
ncbi_genus
append(missing_families, "b")
missing_families <- append(missing_families, "b")
append(missing_families, "b")
ncbi_genus
missing_families
missing_families <- append(missing_families, "a")
missing_families
missing_families <- c()
print(paste("Missing family ", as.character(ncbi_family$childtaxa_name[j]), " children due to API query error", sep= ""))
df_c2s <- df_c2g
missing_genera <- c()
df_c2s
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
if (nrow(genus) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
else {
missing_genera <- append(missing_genera, ncbi_genus$childtaxa_name[j])
print(paste("Missing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error", sep= ""))
}
}
ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]]
if (nrow(genus) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
species
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]]
species
if (nrow(species) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
df_c2s <- df_c2g
species
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
if (nrow(species) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
else {
missing_genera <- append(missing_genera, ncbi_genus$childtaxa_name[j])
print(paste("Missing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error", sep= ""))
}
}
missing_genera
ncbi_genus
df_c2s <- df_c2g
df_c2s
print(paste("/n/n/nMissing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error/n/n/n", sep= ""))
print(paste("
Missing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error
", sep= ""))
print(paste("Missing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error", sep= ""))
df_c2s
missing_genera
missing_genera <- c()
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
if (nrow(species) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
else {
missing_genera <- append(missing_genera, ncbi_genus$childtaxa_name[j])
print(paste("Missing ", as.character(ncbi_genus$childtaxa_name[j]), " genus children due to API query error", sep= ""))
}
}
df_c2s <- df_c2g
missing_genera
missing_genera <- c()
for (k in 1:nrow(ncbi_genus)){
species <- ncbi_children(name = ncbi_genus$childtaxa_name[k], ancestor = "Florideophyceae")[1][[1]] #%>% filter(childtaxa_rank == "genus")
if (nrow(species) > 0) {
species$parent <- ncbi_genus$childtaxa_name[k]
species$parent_rank <- "genus"
print(species)
df_c2s <- rbind(df_c2s, species)
}
else {
missing_genera <- append(missing_genera, ncbi_genus$childtaxa_name[k])
print(paste("Missing ", as.character(ncbi_genus$childtaxa_name[k]), " genus children due to API query error", sep= ""))
}
}
ncbi_species <<- filter(df_c2s, childtaxa_rank == "species") %>% arrange(childtaxa_name)
nrow(ncbi_species)
ncbi_genera
ncbi_genus
missing_genera
nrow(ncbi_genus)
df_c2g
df_c2s
write.csv(df_c2s, file = "../data/ncbi_global_Rhodophyta_tax.csv")
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df
nrow(df)
head(df)
write.csv(df_c2s, file = "../data/ncbi_global_Rhodophyta_tax.csv", rownames = FALSE)
write.csv(df_c2s, file = "../data/ncbi_global_Rhodophyta_tax.csv", row.names = FALSE)
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
head(df)
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus"))
levels(df$childtaxa_rank)
df$childtaxa_rank
nrow(ncbi_family)
nrow(ncbi_order)
114-25
head(df)
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
df
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df <- arrange(df, childtaxa_name)
df
df$childtaxa_name
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus"))
df %>% summarize(n(childtaxa_name))
df %>% group_by(childtaxa_name) %>% summarize(n())
doubles <- df %>% group_by(childtaxa_name) %>% summarize(n())
which(doubles$`n()` > 1)
nrow(df)
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
nrow(df)
library(tidyr)
library(tidyr)
x <- data(pollution)
x <- load(pollution)
x <- data(mtcars)
mtcars
head(mtcars)
head(df)
tail(df)
test <- head(df)
test
spread(test, parent)
spread(test, parent, parent_rank)
spread(df, parent_rank, parent_rank)
head(df)
genus <- filter(df, childtaxa_rank == "genus")
genus
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
genus <- filter(df, childtaxa_rank == "genus")
genus
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus"), parent_rank = "family") %>% distinct(childtaxa_name)
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus"), parent_rank == "family") %>% distinct(childtaxa_name)
df
genus <- filter(df, childtaxa_rank == "genus")
nrow(genus)
nrow(df)
head(df)
df
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
df
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
df
test <- spread(df, parent_rank, parent)
test
genus <- filter(df, parent_rank == "family")
genus
names(genus$parent) <- "family"
genus
head(genus)
names(genus$parent) <- c("family")
head(genus)
names(genus)
colnames(genus)
colnames(genus$parent) <- c("family")
colnames(genus$parent)
colname(genus$parent)
head(genus)
colnames(genus)
colnames(genus[4])
colnames(genus[4]) <- c("family")
head(genus)
colnames(genus[4]) <- "family"
colneams(genus)
colnames(genus)
family <- filter(df, parent_rank == "order")
family
colnames(genus)
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name) %>% select(childtaxa_id, childtaxa_name, parent, source)
df
head(df)
df <- read.csv("../data/ncbi_global_Rhodophyta_tax.csv")
df <- filter(df, childtaxa_rank %in% c("order", "family", "genus")) %>% distinct(childtaxa_name)
genus <- filter(df, parent_rank == "family") %>% select(childtaxa_id, childtaxa_name, parent, source)
genus
head(genus)
genus <- filter(df, parent_rank == "family") %>% select(childtaxa_id, childtaxa_name, childtaxa_rank, parent, source)
head9genus
head(genus)
genus$childtaxa_rank
which(genus$childtaxa_rank != "genus")
head(genus)
colnames(genus) <- c("childtaxa_id", "childtaxa_name", "childtaxa_rank", "family", "source")
family <- filter(df, parent_rank == "order")
head(family)
genus$order <- family$parent[match(genus$family, family$childtaxa_name)]
head(genus)
class <- filter(df, parent_rank ==- "class")
class <- filter(df, parent_rank == "class")
head(class)
nrow(class)
genus$class <- class$parent[match(genus$family, class$childtaxa_name)]
head(genus)
genus$class <- class$parent[match(genus$order, class$childtaxa_name)]
head(genus)
which(is.na(genus))
genus
which(is.na(genus))
